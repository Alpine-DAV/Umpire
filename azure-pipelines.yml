trigger:
- develop

strategy:
  matrix: 
    linux: 
      imageName: 'ubuntu-16.04'
      CMAKE_EXTRA_FLAGS: '-DENABLE_CUDA=Off'
    windows:
      imageName: 'vs2017-win2016'
      CMAKE_EXTRA_FLAGS: '-DENABLE_CUDA=Off'
    mac:
      imageName: 'macos-10.13'
      CMAKE_EXTRA_FLAGS: '-DENABLE_CUDA=Off -DENABLE_OPENMP=Off'

pool:
  vmImage: $(imageName)

variables:
  DO_BUILD: 'yes'
  DO_TEST: 'yes'
  COMPILER: 'g++'

steps:
- checkout: self
  clean: boolean
  submodules: recursive
- task: CMake@1
  inputs:
    workingDir: 'build'
    cmakeArgs: '$(CMAKE_EXTRA_FLAGS) ../'
  condition: or( eq( variables['Agent.OS'], 'Windows_NT'), eq( variables['Agent.OS'], 'Darwin'))
- task: VSBuild@1
  condition: eq( variables['Agent.OS'], 'Windows_NT')
- task: Xcode@5
  condition: eq( variables['Agent.OS'], 'Darwin')
- script:  |
   docker run --rm --user='root' -v `pwd`:/home/axom axom/compilers:gcc-6 chown -R axom /home/axom
   docker run --rm  -v `pwd`:/home/axom -e COMPILER -e DO_BUILD -e DO_TEST -e CMAKE_EXTRA_FLAGS axom/compilers:gcc-6 ./scripts/travis/build_and_test.sh
  condition: eq( variables['Agent.OS'], 'Linux')

  displayName: 'build'
